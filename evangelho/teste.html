<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Liturgia Diária</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
        }
        .liturgia-section {
            margin-bottom: 20px;
        }
        .liturgia-section h2 {
            color: #2c3e50;
            font-size: 1.5em;
            margin-bottom: 10px;
        }
        .liturgia-section h3 {
            color: #2c3e50;
            font-size: 1.3em;
            margin-bottom: 8px;
        }
        .liturgia-section p {
            line-height: 1.6;
        }
        .loading, .error {
            color: #888;
            font-style: italic;
        }
        .navegacao {
            text-align: center;
            margin-bottom: 20px;
        }
        .navegacao button {
            padding: 8px 16px;
            margin: 0 10px;
            background-color: #2c3e50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .navegacao button:hover {
            background-color: #34495e;
        }
        .navegacao input[type="date"] {
            padding: 6px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
            h1 {
                font-size: 1.8em;
            }
            .liturgia-section h2 {
                font-size: 1.3em;
            }
            .liturgia-section h3 {
                font-size: 1.1em;
            }
            .navegacao button {
                padding: 6px 12px;
                margin: 0 5px;
            }
            .navegacao input[type="date"] {
                width: 100%;
                margin-top: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="navegacao">
            <button onclick="navegarDia(-1)">Dia Anterior</button>
            <button onclick="voltarHoje()">Hoje</button>
            <button onclick="navegarDia(1)">Próximo Dia</button>
            <input type="date" id="selecionar-data" onchange="carregarLiturgia(this.value)">
        </div>
        <h1>Liturgia Diária - <span id="data">Carregando...</span></h1>
        <div id="liturgia-content">
            <div class="liturgia-section">
                <h2>Primeira Leitura</h2>
                <p id="primeira-leitura" class="loading">Carregando...</p>
            </div>
            <div class="liturgia-section">
                <h2>Salmo</h2>
                <p id="salmo" class="loading">Carregando...</p>
            </div>
            <div class="liturgia-section">
                <h2>Segunda Leitura</h2>
                <p id="segunda-leitura" class="loading">Carregando...</p>
            </div>
            <div class="liturgia-section">
                <h2>Evangelho</h2>
                <p id="evangelho" class="loading">Carregando...</p>
            </div>
        </div>
    </div>

    <script>
        let dataAtual = new Date().toISOString().split('T')[0];

        function formatarData(data) {
            const meses = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 
                           'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            const [ano, mes, dia] = data.split('-');
            return `${parseInt(dia)} de ${meses[parseInt(mes) - 1]} de ${ano}`;
        }

        async function carregarLiturgia(dataSelecionada) {
            dataAtual = dataSelecionada || dataAtual;
            document.getElementById('selecionar-data').value = dataAtual;
            document.getElementById('data').innerText = formatarData(dataAtual);
            const contentContainer = document.getElementById('liturgia-content');
            contentContainer.innerHTML = `
                <div class="liturgia-section">
                    <h2>Primeira Leitura</h2>
                    <p id="primeira-leitura" class="loading">Carregando...</p>
                </div>
                <div class="liturgia-section">
                    <h2>Salmo</h2>
                    <p id="salmo" class="loading">Carregando...</p>
                </div>
                <div class="liturgia-section">
                    <h2>Segunda Leitura</h2>
                    <p id="segunda-leitura" class="loading">Carregando...</p>
                </div>
                <div class="liturgia-section">
                    <h2>Evangelho</h2>
                    <p id="evangelho" class="loading">Carregando...</p>
                </div>
            `;

            try {
                const response = await fetch(`https://liturgia.up.railway.app/v2/?dia=${dataAtual.split('-')[2]}&mes=${dataAtual.split('-')[1]}&ano=${dataAtual.split('-')[0]}`);
                if (!response.ok) throw new Error('Liturgia não encontrada');
                const data = await response.json();

                // Verificar se é Sábado Santo (Vigília Pascal)
                const isVigiliaPascal = data.liturgia?.includes('Vigília Pascal');
                if (isVigiliaPascal) {
                    contentContainer.innerHTML = '';
                    const leiturasExtras = (data.leituras.extras || []).filter(extra => !extra.titulo.includes('Proclamação da Páscoa'));
                    const salmos = data.leituras.salmo || [];
                    const exulte = (data.leituras.extras || []).find(extra => extra.titulo.includes('Proclamação da Páscoa')) || {};

                    // Exulte (Proclamação da Páscoa)
                    if (exulte.texto) {
                        contentContainer.innerHTML += `
                            <div class="liturgia-section">
                                <h2>Proclamação da Páscoa</h2>
                                <p>${exulte.texto}</p>
                            </div>
                        `;
                    }

                    // Primeira Leitura e Salmo
                    const primeiraLeitura = data.leituras.primeiraLeitura?.[0] || {};
                    contentContainer.innerHTML += `
                        <div class="liturgia-section">
                            <h2>Primeira Leitura</h2>
                            <p>${primeiraLeitura.texto ? `${primeiraLeitura.titulo}\n\n${primeiraLeitura.texto}` : 'Leitura não disponível'}</p>
                        </div>
                        <div class="liturgia-section">
                            <h2>Salmo</h2>
                            <p>${salmos[0]?.texto ? `${salmos[0].referencia}: ${salmos[0].refrao}\n\n${salmos[0].texto}` : 'Salmo não disponível'}</p>
                        </div>
                    `;

                    // Segunda Leitura e Salmo
                    const segundaLeitura = data.leituras.segundaLeitura?.[0] || {};
                    contentContainer.innerHTML += `
                        <div class="liturgia-section">
                            <h2>Segunda Leitura</h2>
                            <p>${segundaLeitura.texto ? `${segundaLeitura.titulo}\n\n${segundaLeitura.texto}` : 'Leitura não disponível'}</p>
                        </div>
                        <div class="liturgia-section">
                            <h2>Salmo</h2>
                            <p>${salmos[1]?.texto ? `${salmos[1].referencia}: ${salmos[1].refrao}\n\n${salmos[1].texto}` : 'Salmo não disponível'}</p>
                        </div>
                    `;

                    // Leituras Extras (3ª a 7ª) com Salmos
                    for (let i = 0; i < leiturasExtras.length && i < 5; i++) {
                        const extra = leiturasExtras[i];
                        const salmoIndex = i + 2;
                        contentContainer.innerHTML += `
                            <div class="liturgia-section">
                                <h2>${extra.tipo || `Leitura ${i + 3}`}</h2>
                                <p>${extra.texto ? `${extra.titulo}\n\n${extra.texto}` : 'Leitura não disponível'}</p>
                            </div>
                            <div class="liturgia-section">
                                <h2>Salmo</h2>
                                <p>${salmos[salmoIndex]?.texto ? `${salmos[salmoIndex].referencia}: ${salmos[salmoIndex].refrao}\n\n${salmos[salmoIndex].texto}` : 'Salmo não disponível'}</p>
                            </div>
                        `;
                    }

                    // Evangelho
                    const evangelho = data.leituras.evangelho?.[0] || {};
                    contentContainer.innerHTML += `
                        <div class="liturgia-section">
                            <h2>Evangelho</h2>
                            <p>${evangelho.texto ? `${evangelho.titulo}\n\n${evangelho.texto}` : 'Evangelho não disponível'}</p>
                        </div>
                    `;
                } else {
                    // Layout padrão com possível sequência
                    const primeiraLeitura = data.leituras.primeiraLeitura?.[0] || {};
                    document.getElementById('primeira-leitura').innerText = 
                        primeiraLeitura.texto ? `${primeiraLeitura.titulo}\n\n${primeiraLeitura.texto}` : 'Leitura não disponível para esta data';

                    const salmo = data.leituras.salmo?.[0] || {};
                    document.getElementById('salmo').innerText = 
                        salmo.texto ? `${salmo.referencia}: ${salmo.refrao}\n\n${salmo.texto}` : 'Salmo não disponível para esta data';

                    const segundaLeitura = data.leituras.segundaLeitura?.[0] || {};
                    document.getElementById('segunda-leitura').innerText = 
                        segundaLeitura.texto ? `${segundaLeitura.titulo}\n\n${segundaLeitura.texto}` : 'Leitura não disponível para esta data';

                    // Sequência (se presente em extras)
                    const sequencia = (data.leituras.extras || []).find(extra => extra.titulo?.toLowerCase().includes('sequência') || extra.texto?.toLowerCase().includes('sequência')) || {};
                    if (sequencia.texto) {
                        contentContainer.innerHTML = `
                            <div class="liturgia-section">
                                <h2>Primeira Leitura</h2>
                                <p>${primeiraLeitura.texto ? `${primeiraLeitura.titulo}\n\n${primeiraLeitura.texto}` : 'Leitura não disponível'}</p>
                            </div>
                            <div class="liturgia-section">
                                <h2>Salmo</h2>
                                <p>${salmo.texto ? `${salmo.referencia}: ${salmo.refrao}\n\n${salmo.texto}` : 'Salmo não disponível'}</p>
                            </div>
                            <div class="liturgia-section">
                                <h2>Segunda Leitura</h2>
                                <p>${segundaLeitura.texto ? `${segundaLeitura.titulo}\n\n${segundaLeitura.texto}` : 'Leitura não disponível'}</p>
                            </div>
                            <div class="liturgia-section">
                                <h2>Sequência</h2>
                                <p>${sequencia.texto}</p>
                            </div>
                            <div class="liturgia-section">
                                <h2>Evangelho</h2>
                                <p id="evangelho" class="loading">Carregando...</p>
                            </div>
                        `;
                    }

                    const evangelho = data.leituras.evangelho?.[0] || {};
                    document.getElementById('evangelho').innerText = 
                        evangelho.texto ? `${evangelho.titulo}\n\n${evangelho.texto}` : 'Evangelho não disponível para esta data';

                    document.getElementById('primeira-leitura').classList.remove('loading');
                    document.getElementById('salmo').classList.remove('loading');
                    document.getElementById('segunda-leitura').classList.remove('loading');
                    document.getElementById('evangelho').classList.remove('loading');
                }
            } catch (error) {
                console.error('Erro ao carregar liturgia:', error);
                document.getElementById('primeira-leitura').innerText = 'Leitura não disponível para esta data';
                document.getElementById('salmo').innerText = 'Salmo não disponível para esta data';
                document.getElementById('segunda-leitura').innerText = 'Leitura não disponível para esta data';
                document.getElementById('evangelho').innerText = 'Evangelho não disponível para esta data';
                document.getElementById('primeira-leitura').classList.add('error');
                document.getElementById('salmo').classList.add('error');
                document.getElementById('segunda-leitura').classList.add('error');
                document.getElementById('evangelho').classList.add('error');
            }
        }

        function navegarDia(dias) {
            const data = new Date(dataAtual);
            data.setDate(data.getDate() + dias);
            dataAtual = data.toISOString().split('T')[0];
            carregarLiturgia(dataAktual);
        }

        function voltarHoje() {
            dataAtual = new Date().toISOString().split('T')[0];
            carregarLiturgia(dataAtual);
        }

        document.addEventListener('DOMContentLoaded', () => carregarLiturgia());
    </script>
</body>
</html>